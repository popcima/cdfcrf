<!DOCTYPE html>

<html lang="en">
<head>
<title>Watch Free Movies and Tv Series on popcima.com</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<meta content="en" http-equiv="content-language"/>
<meta content="Welcome to popcima.com , your ultimate destination for all things movies and series! Whether you're a film enthusiast, a binge-watcher, or simply looking for your next entertainment fix, we've got you covered with an extensive collection of reviews, trailers, and recommendations." name="description"/>
<meta content="best movies site, free movies watch, free movies streaming, free series watch, watch movies online, watch free movies, watch movies free" name="keywords"/>
<meta content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" name="viewport"/>
<link href="images/icon.png" rel="shortcut icon" type="image/x-icon"/>
<meta content="website" property="og:type"/>
<meta content="https://popcima.com/movies" property="og:url"/>
<meta content="Watch Free Movies and Tv Series on popcima.com" property="og:title"/>
<meta content="images/featured.jpg" property="og:image"/>
<meta content="650" property="og:image:width"/>
<meta content="350" property="og:image:height"/>
<meta content="Welcome to popcima.com , your ultimate destination for all things movies and series! Whether you're a film enthusiast, a binge-watcher, or simply looking for your next entertainment fix, we've got you covered with an extensive collection of reviews, trailers, and recommendations." property="og:description"/>
<!--Begin: Stylesheet-->
<link href="css/Pvq5Z12mGY4f.css" rel="stylesheet"/>
<link href="css/8n31zTeH0XHr.css" rel="stylesheet"/>
<link href="css/1UQYHyIhUvds.css" rel="stylesheet"/>
<style>
@media (max-width: 900px) {
    .movies-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 16px;
    }
}
@media (min-width: 901px) {
    .movies-grid {
        display: grid;
        grid-template-columns: repeat(8, 1fr) !important;
        gap: 20px;
    }
      .hd-label {
  position: absolute;
  top: 8px;
  left: 8px;
  background-color: #00acc1;
  color: white;
  font-size: 1rem;
  font-weight: normal;
  padding: 2px 5px;
  border-radius: 3px;
  z-index: 2;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.6);
}
.film-thumbnail {
  position: relative;
}
}
</style>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L23YZD83ZH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L23YZD83ZH');
</script>

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SKYXYJCQ9D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SKYXYJCQ9D');
</script>
</head>
<body id="gMNrTK">
<div id="mobile-overlay"></div>
<div id="menu-display"></div>
<div id="app">
<!--/// Header ///-->
 <header class="over-air">
        <div class="container">
            <div id="header_elements" style="display: flex; align-items: center; justify-content: space-between;">
                <a href="/" id="header_logo" style="margin-right: 32px;">
                    <img src="images/logo.png" alt="popcima.com">
                </a>
                <!-- Desktop Navigation -->
                <nav class="desktop-nav" style="display: flex; gap: 32px; align-items: center;">
                    <a href="/movies.html" class="nav-link" style="margin-right: 16px;">Movies</a>
                    <a href="/series.html" class="nav-link" style="margin-right: 16px;">Series</a>
                    <form id="desktop-search-form" action="/search.html" method="get" style="display: inline; margin-left: 16px;">
                        <input type="text" name="q" placeholder="Search..." style="padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc;">
                        <button type="submit" style="padding: 5px 16px; border-radius: 6px; border: none; background: #00acc1; color: #fff; font-weight: 600; font-size: 1rem; box-shadow: 0 2px 8px rgba(229,9,20,0.15); transition: background 0.2s; display: inline-flex; align-items: center; gap: 8px;">
                            <i class="fas fa-search" style="margin-right: 6px;"></i>Search
                        </button>
                    </form>
                </nav>
                <!-- Mobile Menu Toggle -->
                <button id="mobile-menu-toggle" aria-label="Open menu" style="background: none; border: none; font-size: 2rem; color: #fff; display: none; margin-left: 32px;">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
        <!-- Mobile Menu Drawer -->
        <div id="mobile-menu" style="display: none; position: fixed; top: 0; right: 0; width: 80vw; max-width: 320px; height: 100vh; background: #18191a; z-index: 1000; box-shadow: -2px 0 8px rgba(0,0,0,0.2); padding: 32px 20px;">
            <button id="mobile-menu-close" aria-label="Close menu" style="background: none; border: none; font-size: 2rem; color: #fff; position: absolute; top: 16px; right: 16px;">
                <i class="fas fa-times"></i>
            </button>
            <nav style="display: flex; flex-direction: column; gap: 32px; margin-top: 40px;">
                <a href="/movies.html" class="nav-link" style="color: #fff; font-size: 1.2rem;">Movies</a>
                <a href="/series.html" class="nav-link" style="color: #fff; font-size: 1.2rem;">Series</a>
                <form id="mobile-search-form" action="/search.html" method="get" style="display: flex; gap: 12px;">
    <input type="text" name="q" placeholder="Search..." style="flex:1; padding: 7px 10px; border-radius: 4px; border: 1px solid #ccc;">
    <button type="submit" style="padding: 7px 10px; border-radius: 4px; border: none; background: #00acc1; color: #fff;">Go</button>
</form>

            </nav>
        </div>
        <style>
            .badge-tag.quality{
                background-color: aqua;
                border-radius: 10px;
                padding: 5px;
                font-size: small;
            }
            @media (max-width: 900px) {
                .desktop-nav { display: none !important; }
                #mobile-menu-toggle { display: inline-block !important; }
            }
            @media (min-width: 901px) {
                #mobile-menu-toggle { display: none !important; }
                #mobile-menu { display: none !important; }
            }
        </style>
        <script>
            // Mobile menu toggle logic
            const menuToggle = document.getElementById('mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            const menuClose = document.getElementById('mobile-menu-close');
            const mobileOverlay = document.getElementById('mobile-overlay');
            menuToggle && menuToggle.addEventListener('click', () => {
                mobileMenu.style.display = 'block';
                if (mobileOverlay) mobileOverlay.style.display = 'block';
            });
            menuClose && menuClose.addEventListener('click', () => {
                mobileMenu.style.display = 'none';
                if (mobileOverlay) mobileOverlay.style.display = 'none';
            });
            if (mobileOverlay) {
                mobileOverlay.addEventListener('click', () => {
                    mobileMenu.style.display = 'none';
                    mobileOverlay.style.display = 'none';
                });
            }
        </script>
    </header>
<!--/// End Header ///-->
<div class="filters svelte-nghlsj" id="filters-section" style="margin: 40px 0;">
<div class="filters-row svelte-nghlsj" style="margin-top: 32px; margin-bottom: 16px; display: flex; justify-content: center;">
<div style="display: flex; gap: 18px; flex-wrap: wrap; justify-content: center; max-width: 800px; width: 100%;">
<!-- Genres Filter -->
<div class="filter-group svelte-nghlsj">
<button class="filter-btn genres-btn svelte-nghlsj" id="genres-toggle-btn" type="button">
<span class="btn-content svelte-nghlsj">
<span class="btn-text">Genres</span>
<span class="arrow svelte-nghlsj">
<svg fill="none" height="6" viewbox="0 0 10 6" width="10">
<path d="M1 1L5 5L9 1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path>
</svg>
</span>
</span>
</button>
<div id="genres-collapse" style="display:none; background:#18191a; border-radius:6px; margin-top:8px; padding:10px 0; position:absolute; z-index:10; min-width:180px; box-shadow:0 4px 16px rgba(0,0,0,0.15);">
<ul id="genres-list" style="list-style:none; margin:0; padding:0;">
<li style="color:#aaa; padding:8px 18px;">Loading...</li>
</ul>
</div>
</div>
<!-- Year Filter -->
<div class="filter-group svelte-nghlsj">
<button class="filter-btn svelte-nghlsj" id="year-toggle-btn" type="button">
<span class="btn-content svelte-nghlsj">
<span class="btn-text">Year</span>
<span class="arrow svelte-nghlsj">
<svg fill="none" height="6" viewbox="0 0 10 6" width="10">
<path d="M1 1L5 5L9 1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path>
</svg>
</span>
</span>
</button>
<div id="year-collapse" style="display:none; background:#18191a; border-radius:6px; margin-top:8px; padding:10px 0; position:absolute; z-index:10; min-width:180px; box-shadow:0 4px 16px rgba(0,0,0,0.15);">
<ul id="year-list" style="list-style:none; margin:0; padding:0; max-height:300px; overflow-y:auto;">
<li style="color:#aaa; padding:8px 18px;">Loading...</li>
</ul>
</div>
</div>
<!-- Rating Filter -->
<div class="filter-group svelte-nghlsj">
<style>
                #rating-slider::-webkit-slider-thumb {
                    background-color: orange;
                    border: none;
                }
                #rating-slider::-moz-range-thumb {
                    background-color: orange;
                    border: none;
                }
                #rating-slider::-ms-thumb {
                    background-color: orange;
                    border: none;
                }
                #rating-slider {
                    accent-color: orange;
                }
            </style>
<button class="filter-btn svelte-nghlsj" id="rating-toggle-btn" type="button">
<span class="btn-content svelte-nghlsj">
<span class="btn-text">Rating</span>
<span class="arrow svelte-nghlsj">
<svg fill="none" height="6" viewbox="0 0 10 6" width="10">
<path d="M1 1L5 5L9 1" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"></path>
</svg>
</span>
</span>
</button>
<div id="rating-collapse" style="display:none; background:#18191a; border-radius:6px; margin-top:8px; padding:16px 18px; position:absolute; z-index:10; min-width:220px; box-shadow:0 4px 16px rgba(0,0,0,0.15); color:#fff;">
<label for="rating-slider" style="display:block; margin-bottom:10px;">Minimum Rating: <span id="rating-value">5</span></label>
<input id="rating-slider" max="10" min="1" step="0.1" style="width:100%;" type="range" value="5"/>
</div>
</div>
<!-- Sort Buttons -->
<div class="filter-group sort-group svelte-nghlsj" style="display: flex; justify-content: center; align-items: center; gap: 12px;">
<button class="filter-btn svelte-nghlsj active" id="popular-btn" type="button">
<span class="btn-content svelte-nghlsj">
<span class="btn-text">Popular</span>
</span>
</button>
<button class="filter-btn svelte-nghlsj" id="top-rated-btn" type="button">
<span class="btn-content svelte-nghlsj">
<span class="btn-text">Most Voted</span>
</span>
</button>
</div>
</div>
</div>
</div>
<style>
     #filters-section {
        background-color: #121315;
        padding: 20px;
        border-radius: 8px;
        color: #fff;
     }

     .filter-toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: #1c1c1e;
        padding: 10px 15px;
        border: none;
        border-radius: 6px;
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
     }

     .providers-scroll {
        display: flex;
        overflow-x: auto;
        padding: 10px 0;
        gap: 10px;
     }

     .providers-row {
        display: flex;
        gap: 10px;
     }

     .provider-logo-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 5px;
        border-radius: 6px;
        transition: transform 0.2s;
     }

     .provider-logo-btn:hover {
        transform: scale(1.1);
     }

     .provider-logo {
        width: 60px;
        height: 60px;
        border-radius: 50%;
     }

     .filters-row {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
     }

     .filter-btn {
        background-color: #1c1c1e;
        padding: 10px 15px;
        border: none;
        border-radius: 6px;
        color: #fff;
        font-size: 0.9rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
     }

     .filter-btn.active {
        background-color: #00acc1;
     }

     .filter-btn:hover {
        background-color: #00acc1;
     }

     .btn-content {
        display: flex;
        align-items: center;
        gap: 5px;
     }

     .btn-text {
        font-weight: 600;
     }

     .arrow svg {
        transition: transform 0.2s;
     }

     .filter-btn:hover .arrow svg {
        transform: rotate(180deg);
     }
    </style>
<div class="container">
<div class="movies-list" id="movies-list" style="margin-top: 20px;">
<!-- Movies will be loaded here -->
<div class="loading-spinner" style="text-align: center; margin-top: 50px;">
<i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #00acc1;"></i>
<p style="color: #aaa;">Loading movies...</p>
</div>
</div>
</div>
<footer>
<div class="footer-top" style="background-color: #121315;">
<div class="container">
<div class="d-flex footer-elements">
<div class="footer-logo">
<a class="is-logo" href="https://popcima.com"><img alt="popcima.com" src="images/logo.png"/></a>
</div>
<div class="footer-about">
<div class="heading-sm mb-3">About Us</div>
<p>
                            Welcome to <a href="https://popcima.com">
<strong>popcima.com</strong>
</a>, your ultimate destination for all things movies and series! Whether you're a film enthusiast, a binge-watcher, or simply looking for your next entertainment fix, we've got you covered with an extensive collection of reviews, trailers, and recommendations.
                        </p>
<small>This site does not store any files on our server, we only linked to the media which is hosted
                            on 3rd party services.</small>
</div>

<!--
<div class="footer-links" style="min-width:180px;">
<div class="heading-sm mb-3">Quick Links</div>
<ul style="list-style:none; padding:0; margin:0;">
<li style="display:inline; margin-right:15px;">
<a href="/index.html" onmouseout="this.style.color='#fff'" onmouseover="this.style.color='#00acc1'" style="color:#fff; text-decoration:none; transition:color 0.2s;">Home</a>
</li>
<li style="display:inline; margin-right:15px;">
<a href="/movies.html" onmouseout="this.style.color='#fff'" onmouseover="this.style.color='#00acc1'" style="color:#00acc1; text-decoration:none; transition:color 0.2s;">Movies</a>
</li>
<li style="display:inline; margin-right:15px;">
<a href="/series.html" onmouseout="this.style.color='#fff'" onmouseover="this.style.color='#00acc1'" style="color:#fff; text-decoration:none; transition:color 0.2s;">Series</a>
</li>
<li style="display:inline; margin-right:15px;">
<a href="/privacy-policy.html" onmouseout="this.style.color='#fff'" onmouseover="this.style.color='#00acc1'" style="color:#fff; text-decoration:none; transition:color 0.2s;">Privacy Policy</a>
</li>
<li style="display:inline;">
<a href="/terms-of-use.html" onmouseout="this.style.color='#fff'" onmouseover="this.style.color='#00acc1'" style="color:#fff; text-decoration:none; transition:color 0.2s;">Terms of Use</a>
</li>
</ul>
</div>
-->
<div class="flex-grow"></div>
</div>
</div>
</div>
</footer>
</div>
<script>
// TMDb API Configuration
const API_KEY = '84259f99204eeb7d45c7e3d8e36c6123';
const BASE_URL = 'https://api.themoviedb.org/3';
const IMG_BASE_URL = 'https://image.tmdb.org/t/p/w500';

// Global Variables
let currentPage = 1;
let selectedYear = null;   // ✅ <-- Add this line

let isLoading = false;
let currentEndpoint = 'trending';
let selectedGenre = null;
let minRating = 5;
let hasMorePages = true;

// Initialize the app
document.addEventListener('DOMContentLoaded', function() {
    initializeFilters();
    loadMovies(true);
    setupInfiniteScroll();
});

// Initialize filter functionality
function initializeFilters() {
    // Year dropdown
const yearToggle = document.getElementById('year-toggle-btn');
const yearCollapse = document.getElementById('year-collapse');
const yearList = document.getElementById('year-list');

yearToggle.addEventListener('click', function(e) {
    e.stopPropagation();
    if (yearCollapse.style.display === 'none' || yearCollapse.style.display === '') {
        yearCollapse.style.display = 'block';
        if (yearList.childElementCount <= 1) {
            loadYears();
        }
    } else {
        yearCollapse.style.display = 'none';
    }
});

function loadYears() {
    yearList.innerHTML = '';
    const currentYear = new Date().getFullYear();
    for (let y = currentYear; y >= 1950; y--) {
        const li = document.createElement('li');
        li.textContent = y;
        li.style.cssText = 'padding: 8px 18px; cursor: pointer; color: #fff;';
        li.addEventListener('click', function () {
            selectedYear = y;
            updateYearButtonText(y);
            yearCollapse.style.display = 'none';
            loadMovies(true);
        });
        li.addEventListener('mouseover', () => li.style.background = '#232325');
        li.addEventListener('mouseout', () => li.style.background = 'none');
        yearList.appendChild(li);
    }

    // "All Years" option
    const allYears = document.createElement('li');
    allYears.textContent = 'All Years';
    allYears.style.cssText = 'padding: 8px 18px; cursor: pointer; color: #fff;';
    allYears.addEventListener('click', function () {
        selectedYear = null;
        updateYearButtonText('Year');
        yearCollapse.style.display = 'none';
        loadMovies(true);
    });
    allYears.addEventListener('mouseover', () => allYears.style.background = '#232325');
    allYears.addEventListener('mouseout', () => allYears.style.background = 'none');
    yearList.insertBefore(allYears, yearList.firstChild);
}

function updateYearButtonText(text) {
    const yearButton = document.querySelector('#year-toggle-btn .btn-text');
    yearButton.textContent = text;
}

    // Genres dropdown
    const genresToggle = document.getElementById('genres-toggle-btn');
    const genresCollapse = document.getElementById('genres-collapse');
    const genresList = document.getElementById('genres-list');
    let genresLoaded = false;

    genresToggle.addEventListener('click', function(e) {
        e.stopPropagation();
        if (genresCollapse.style.display === 'none' || genresCollapse.style.display === '') {
            genresCollapse.style.display = 'block';
            if (!genresLoaded) {
                loadGenres();
                genresLoaded = true;
            }
        } else {
            genresCollapse.style.display = 'none';
        }
    });

    // Rating slider
    const ratingToggle = document.getElementById('rating-toggle-btn');
    const ratingCollapse = document.getElementById('rating-collapse');
    const ratingSlider = document.getElementById('rating-slider');
    const ratingValue = document.getElementById('rating-value');

    ratingToggle.addEventListener('click', function(e) {
        e.stopPropagation();
        ratingCollapse.style.display = (ratingCollapse.style.display === 'none' || ratingCollapse.style.display === '') ? 'block' : 'none';
    });

    ratingSlider.addEventListener('input', function() {
        ratingValue.textContent = ratingSlider.value;
        minRating = parseFloat(ratingSlider.value);
        debounce(applyFilters, 500)();
    });

    // Sort buttons
    const popularBtn = document.getElementById('popular-btn');
    const topRatedBtn = document.getElementById('top-rated-btn');

    popularBtn.addEventListener('click', function() {
    setActiveSort('popular');
    currentEndpoint = 'trending';
    loadMovies(true);
});

topRatedBtn.addEventListener('click', function() {
    setActiveSort('top-rated');
    currentEndpoint = 'top_rated';
    loadMovies(true);
});


    // Close dropdowns when clicking outside
    document.addEventListener('click', function(e) {
    if (!genresCollapse.contains(e.target) && e.target !== genresToggle) {
        genresCollapse.style.display = 'none';
    }
    if (!ratingCollapse.contains(e.target) && e.target !== ratingToggle) {
        ratingCollapse.style.display = 'none';
    }
    if (!yearCollapse.contains(e.target) && e.target !== yearToggle) {
        yearCollapse.style.display = 'none';
    }
});

}

// Load genres from API
async function loadGenres() {
    try {
        const response = await fetch(`${BASE_URL}/genre/movie/list?api_key=${API_KEY}&language=en-US`);
        const data = await response.json();
        const genresList = document.getElementById('genres-list');
        
        genresList.innerHTML = '';
        
        // Add "All Genres" option
        const allGenresItem = document.createElement('li');
        allGenresItem.textContent = 'All Genres';
        allGenresItem.className = 'genre-item';
        allGenresItem.style.cssText = 'padding: 8px 18px; cursor: pointer; color: #fff;';
        allGenresItem.addEventListener('click', function() {
            selectedGenre = null;
            updateGenreButtonText('Genres');
            document.getElementById('genres-collapse').style.display = 'none';
            loadMovies(true);
        });
        allGenresItem.addEventListener('mouseover', () => allGenresItem.style.background = '#232325');
        allGenresItem.addEventListener('mouseout', () => allGenresItem.style.background = 'none');
        genresList.appendChild(allGenresItem);

        if (data.genres && Array.isArray(data.genres)) {
            data.genres.forEach(genre => {
                const li = document.createElement('li');
                li.textContent = genre.name;
                li.className = 'genre-item';
                li.style.cssText = 'padding: 8px 18px; cursor: pointer; color: #fff;';
                li.addEventListener('click', function() {
                    selectedGenre = genre.id;
                    updateGenreButtonText(genre.name);
                    document.getElementById('genres-collapse').style.display = 'none';
                    loadMovies(true);
                });
                li.addEventListener('mouseover', () => li.style.background = '#232325');
                li.addEventListener('mouseout', () => li.style.background = 'none');
                genresList.appendChild(li);
            });
        }
    } catch (error) {
        console.error('Error loading genres:', error);
        document.getElementById('genres-list').innerHTML = '<li style="color:#00acc1; padding:8px 18px;">Failed to load genres.</li>';
    }
}

// Update genre button text
function updateGenreButtonText(text) {
    const genreButton = document.querySelector('#genres-toggle-btn .btn-text');
    genreButton.textContent = text;
}

// Set active sort button
function setActiveSort(type) {
    const popularBtn = document.getElementById('popular-btn');
    const topRatedBtn = document.getElementById('top-rated-btn');
    
    popularBtn.classList.toggle('active', type === 'popular');
    topRatedBtn.classList.toggle('active', type === 'top-rated');
}

// Load movies from API
async function loadMovies(reset = false) {
    if (isLoading || (!hasMorePages && !reset)) return;

    isLoading = true;
    const moviesList = document.getElementById('movies-list');

    if (reset) {
        currentPage = 1;
        hasMorePages = true;
        moviesList.innerHTML = '<div class="loading-spinner" style="text-align: center; margin-top: 50px;"><i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #00acc1;"></i><p style="color: #aaa;">Loading movies...</p></div>';
    } else if (!moviesList.querySelector('.loading-spinner')) {
        const loadingDiv = document.createElement('div');
        loadingDiv.className = 'loading-spinner';
        loadingDiv.style.cssText = 'text-align: center; margin-top: 20px;';
        loadingDiv.innerHTML = '<i class="fas fa-spinner fa-spin" style="font-size: 1.5rem; color: #00acc1;"></i>';
        moviesList.appendChild(loadingDiv);
    }

    try {
        let url;
        
        // Use different endpoints based on current selection
        if (currentEndpoint === 'trending') {
            url = `${BASE_URL}/trending/movie/week?api_key=${API_KEY}&page=${currentPage}`;
        } else if (currentEndpoint === 'top_rated') {
            url = `${BASE_URL}/movie/top_rated?api_key=${API_KEY}&page=${currentPage}`;
        } else {
            // Fallback to discover
            url = `${BASE_URL}/discover/movie?api_key=${API_KEY}&page=${currentPage}&sort_by=popularity.desc`;
        }

        // Apply filters only if not using trending endpoint
        if (currentEndpoint !== 'trending') {
            if (selectedGenre) {
                url += `&with_genres=${selectedGenre}`;
            }
            if (minRating > 1) {
                url += `&vote_average.gte=${minRating}`;
            }
            if (selectedYear) {
                url += `&primary_release_year=${selectedYear}`;
            }
        }

        console.log('Fetching URL:', url); // Debug log
        const response = await fetch(url);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();

        if (reset) {
            moviesList.innerHTML = '';
        } else {
            const spinner = moviesList.querySelector('.loading-spinner');
            if (spinner) spinner.remove();
        }

        if (data.results && data.results.length > 0) {
            if (reset || !moviesList.querySelector('.movies-grid')) {
                const moviesGrid = document.createElement('div');
                moviesGrid.className = 'movies-grid';
                moviesList.appendChild(moviesGrid);
            }

            const moviesGrid = moviesList.querySelector('.movies-grid');
            let addedMovies = 0;

            data.results.forEach(movie => {
                if (movie.adult) return; // Skip adult content
                if (movie.vote_average >= minRating && movie.poster_path) {
                    const movieCard = createMovieCard(movie);
                    if (movieCard) {
                        moviesGrid.appendChild(movieCard);
                        addedMovies++;
                    }
                }
            });

            console.log(`Added ${addedMovies} movies to page ${currentPage - 1}`); // Debug log
            currentPage++;
            hasMorePages = currentPage <= data.total_pages && data.results.length > 0;
        } else {
            hasMorePages = false;
            if (reset) {
                moviesList.innerHTML = '<div style="text-align: center; margin-top: 50px; color: #aaa;"><p>No movies found matching your criteria.</p></div>';
            }
        }

    } catch (error) {
        console.error('Error loading movies:', error);
        
        // Remove loading spinner
        const spinner = moviesList.querySelector('.loading-spinner');
        if (spinner) spinner.remove();
        
        // Only show error message if this is the first page or if we don't have any movies yet
        if (reset || !moviesList.querySelector('.movies-grid')) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = 'text-align: center; margin-top: 20px; color: #ff6b6b;';
            errorDiv.innerHTML = '<p>Error loading movies. Please try again.</p><button onclick="loadMovies(true)" style="padding: 8px 16px; background: #00acc1; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">Retry</button>';
            moviesList.appendChild(errorDiv);
        }
        
        // Don't increment page on error
        hasMorePages = false;
    }

    isLoading = false;
}

// Create movie card element

function createMovieCard(movie) {
    if (movie.adult || !movie.poster_path) return null;

    const movieCard = document.createElement('div');
    movieCard.className = 'item-film';

    const posterPath = movie.poster_path ? `${IMG_BASE_URL}${movie.poster_path}` : 'images/no-poster.png';
    const releaseYear = movie.release_date ? new Date(movie.release_date).getFullYear() : '';
    const rating = movie.vote_average ? movie.vote_average.toFixed(1) : '';
    const movieUrl = `moviedetails.html?id=${movie.id}`;
    const title = movie.title || 'Untitled';

    movieCard.innerHTML = `
        <a href="${movieUrl}" class="film-mask"></a>
        <div class="film-thumbnail">
            <span class="hd-label">HD</span>
            <img class="film-thumbnail-img" src="${posterPath}" alt="${title}" loading="lazy">
        </div>
        <div class="film-detail">
            <h3 class="film-name sum-2">
                <a href="${movieUrl}" title="${title}">${title}</a>
            </h3>
            <div class="film-info">
                <span class="item">Movie</span>
                ${releaseYear ? `<span class="item">${releaseYear}</span>` : ''}
                ${rating ? `<span class="item">⭐ ${rating}</span>` : ''}
            </div>
        </div>
    `;

    return movieCard;
}



// Apply filters (debounced)
function applyFilters() {
    loadMovies(true);
}

function debounce(func, wait) {
    let timeout;
    return function (...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
    };
}

/* -----------------  Infinite-scroll helper  ----------------- */
function setupInfiniteScroll() {
    let scrollTimeout;
    
    window.addEventListener('scroll', () => {
        // Debounce scroll events
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
            if (isLoading || !hasMorePages) return;
            
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            
            // Check if user has scrolled to near bottom (within 1000px)
            if (scrollTop + windowHeight >= documentHeight - 1000) {
                console.log('Loading next page...', currentPage); // Debug log
                loadMovies(false);
            }
        }, 100);
    });
}



</script>
<!-- Existing site-wide bundle (leave as-is) -->
<script src="js/upaSRmVXHEek.js"></script>
</body>
</html>
